// Process Parameters:

// Process Parameters for Adapter_Trimmer_Quality_Module_Adapter_Removal:
params.Adapter_Trimmer_Quality_Module_Adapter_Removal.Tool_for_Adapter_Removal =  "trimmomatic"  //* @dropdown @options:"trimmomatic","fastx_clipper" @description:"Choose adapter removal tool to be used. Note: fastx_clipper is not suitable for paired reads." 
params.Adapter_Trimmer_Quality_Module_Adapter_Removal.Adapter_Sequence =  ""  //* @textbox @description:"Removes 3' Adapter Sequences. You can enter a single sequence or multiple sequences in different lines. Reverse sequences will not be removed." @tooltip:"Trimmomatic is used for adapter removal" 
params.Adapter_Trimmer_Quality_Module_Adapter_Removal.min_length =  10  //*  @input @description:"Specifies the minimum length of reads to be kept"
params.Adapter_Trimmer_Quality_Module_Adapter_Removal.seed_mismatches =  1  //* @input @description:"Specifies the maximum mismatch count which will still allow a full match to be performed"
params.Adapter_Trimmer_Quality_Module_Adapter_Removal.palindrome_clip_threshold =  30   //* @input @description:"Specifies how accurate the match between the two -adapter ligated- reads must be for PE palindrome read alignment."
params.Adapter_Trimmer_Quality_Module_Adapter_Removal.simple_clip_threshold =  5  //* @input @description:"specifies how accurate the match between any adapter etc. sequence must be against a read"
params.Adapter_Trimmer_Quality_Module_Adapter_Removal.discard_non_clipped =  "yes"  //* @dropdown @options:"yes","no" @description:"-c: discard_non_clipped sequences (keep only sequences which contained the adapter)"

// Process Parameters for Adapter_Trimmer_Quality_Module_Trimmer:
params.Adapter_Trimmer_Quality_Module_Trimmer.single_or_paired_end_reads =  ""  //* @dropdown @options:"single","pair" 
params.Adapter_Trimmer_Quality_Module_Trimmer.trim_length_5prime =  0  //* @input @description:"Trimming length from 5' end"  
params.Adapter_Trimmer_Quality_Module_Trimmer.trim_length_3prime =  0  //* @input @description:"Trimming length from 3' end"  
params.Adapter_Trimmer_Quality_Module_Trimmer.trim_length_5prime_R1 =  0  //* @input @description:"Trimming length from 5' end of R1 reads"  
params.Adapter_Trimmer_Quality_Module_Trimmer.trim_length_3prime_R1 =  0  //* @input @description:"Trimming length from 3' end of R1 reads"  
params.Adapter_Trimmer_Quality_Module_Trimmer.trim_length_5prime_R2 =  0  //* @input @description:"Trimming length from 5' end of R2 reads"  
params.Adapter_Trimmer_Quality_Module_Trimmer.trim_length_3prime_R2 =  0  //* @input @description:"Trimming length from 3' end of R2 reads" 

// Process Parameters for Adapter_Trimmer_Quality_Module_Quality_Filtering:
params.Adapter_Trimmer_Quality_Module_Quality_Filtering.tool =  "trimmomatic"  //* @dropdown @options:"trimmomatic","fastx" @description:"Choose quality removal tool to be used. Note:fastx option (fastx_toolkit fastq_quality_filter) is not suitable for paired reads." 
params.Adapter_Trimmer_Quality_Module_Quality_Filtering.window_size =  10  //* @input @description:"Performs a sliding window trimming approach. It starts scanning at the 5' end and clips the read once the average quality within the window falls below a threshold (=required_quality)."  
params.Adapter_Trimmer_Quality_Module_Quality_Filtering.required_quality_for_window_trimming =  15  //* @input @description:"specifies the average quality required for window trimming approach" 
params.Adapter_Trimmer_Quality_Module_Quality_Filtering.leading =  5  //* @input @description:"Cut bases off the start of a read, if below a threshold quality" 
params.Adapter_Trimmer_Quality_Module_Quality_Filtering.trailing =  5  //* @input @description:"Cut bases off the end of a read, if below a threshold quality"  
params.Adapter_Trimmer_Quality_Module_Quality_Filtering.minlen =  36  //* @input @description:"Specifies the minimum length of reads to be kept"  
params.Adapter_Trimmer_Quality_Module_Quality_Filtering.minQuality =  20  //* @input @description:"Minimum quality score to keep reads"
params.Adapter_Trimmer_Quality_Module_Quality_Filtering.minPercent =  100  //* @input @description:"Minimum percent of bases that must have entered minQuality"

// Process Parameters for Check_and_Build_Module_Bowtie_Index:
params.Check_and_Build_Module_Bowtie_Index.bowtie_build_parameters =  ""  //* @input

// Process Parameters for Check_and_Build_Module_Check_Build_Rsem_Index:
params.Check_and_Build_Module_Check_Build_Rsem_Index.create_bowtie_rsem_index =  "false"  //* @checkbox 
params.Check_and_Build_Module_Check_Build_Rsem_Index.create_bowtie2_rsem_index =  "false"  //* @checkbox 
params.Check_and_Build_Module_Check_Build_Rsem_Index.create_star_rsem_index =  "true"  //* @checkbox 
params.Check_and_Build_Module_Check_Build_Rsem_Index.transcript_to_gene_map =  ""  //* @input @description:"Activated when transcript_to_gene_map path is entered into this field. It will use transcript_to_gene_map file instead of gtf file (optional)"
params.Check_and_Build_Module_Check_Build_Rsem_Index.RSEM_build_parameters =  "-p 1"  //* @input 

// Process Parameters for Check_and_Build_Module_Hisat2_Index:
params.Check_and_Build_Module_Hisat2_Index.hisat2_build_parameters =  ""  //* @input

// Process Parameters for Check_and_Build_Module_Bowtie2_Index:
params.Check_and_Build_Module_Bowtie2_Index.bowtie2_build_parameters =  ""  //* @input

// Process Parameters for Check_and_Build_Module_STAR_Index_Check_Build:
params.Check_and_Build_Module_STAR_Index_Check_Build.star_build_parameters =  ""  //* @input @description:"star build parameters" 

// Process Parameters for Sequential_Mapping_Module_Sequential_Mapping:
params.Sequential_Mapping_Module_Sequential_Mapping.remove_duplicates =  "no"  //* @dropdown @description:"Duplicates (both PCR and optical) will be removed from alignment file (bam) and separate count table will be created for comparison" @title:"General Mapping Options" @options:{"yes","no"}
params.Sequential_Mapping_Module_Sequential_Mapping.remove_duplicates_based_on_UMI_after_mapping =  "no"  //* @dropdown @description:"UMI extract process should have executed before this step. Read headers should have UMI tags which are separated with underscore.(eg. NS5HGY:2:11_GTATAACCTT)" @options:{"yes","no"}
params.Sequential_Mapping_Module_Sequential_Mapping._select_sequence =  ""  //* @dropdown @description:"Select sequence for mapping" @title:"Sequence Set for Mapping" @options:{"rRNA","ercc","miRNA","tRNA","piRNA","snRNA","rmsk","genome",custom"},{_nucleicAcidType="dna","ercc","rmsk","genome","custom"}
params.Sequential_Mapping_Module_Sequential_Mapping.index_directory =  ""  //* @input  @description:"index directory of sequence(full path)" @tooltip:"The index directory must include the full path and the name of the index file must only be the prefix of the fasta or index file. Index files and Fasta files also need to have the same prefix.For STAR alignment, gtf file which has the same prefix, must be found in same directory" 
params.Sequential_Mapping_Module_Sequential_Mapping.name_of_the_index_file =  ""  //* @input  @autofill:{_select_sequence=("rRNA","ercc","miRNA","tRNA","piRNA","snRNA","rmsk","genome"), _select_sequence},{_select_sequence="custom", " "} @description:"Name of the index or fasta file (prefix)" @tooltip:"The index directory must include the full path and the name of the index file must only be the prefix of the fasta or index file. Index files and Fasta files also need to have the same prefix.For STAR alignment, gtf file which has the same prefix, must be found in same directory" 
params.Sequential_Mapping_Module_Sequential_Mapping._aligner =  "bowtie2"  //* @dropdown @description:"Select aligner tool"  @options:{_select_sequence=("rRNA","ercc","miRNA","tRNA","piRNA","snRNA","rmsk"),"bowtie","bowtie2"},{_select_sequence=("genome","custom"),"bowtie","bowtie2","STAR"}
params.Sequential_Mapping_Module_Sequential_Mapping.aligner_Parameters =  ""  //* @input @description:"Aligner parameters." @autofill:{_aligner="bowtie", "--threads 1"},{_aligner="bowtie2", "-N 1"},{_aligner="STAR", "--runThreadN 1"} 
params.Sequential_Mapping_Module_Sequential_Mapping.description =  ""  //* @input @autofill:{_select_sequence=("rRNA","ercc","miRNA","tRNA","piRNA","snRNA","rmsk","genome"), _select_sequence},{_select_sequence="custom", " "} @description:"Description of index file (please don't use comma or quotes in this field" 
params.Sequential_Mapping_Module_Sequential_Mapping.filter_Out =  "Yes"  //* @dropdown @dropdown @options:"Yes","No" @description:"Select whether or not you want the reads mapped to this index filtered out of your total reads." 

// Process Parameters for SplitFastq:
params.SplitFastq.readsPerFile =  5000000  //* @input @description:"The number of reads per file"

// Process Parameters for Bowtie2_Module_Map_Bowtie2:
params.Bowtie2_Module_Map_Bowtie2.Map_Bowtie2_parameters =  "-p 3"  //* @input @description:"Bowtie2 parameters for mapping" 

// Process Parameters for ChIP_Module_Remove_Multimappers_with_Samtools:
params.ChIP_Module_Remove_Multimappers_with_Samtools.MAPQ_quality =  "4"  //* @input @description:"It removes reads with MAPQ quality less than entered value (4 by default)"

// Process Parameters for BAM_Analysis_Module_featureCounts_Prep:
params.BAM_Analysis_Module_featureCounts_Prep.run_name =  ["gene_id","transcript_id"]  //* @input @title:"Define each of the featureCounts Parameters" @description:"prefix for run output" 
params.BAM_Analysis_Module_featureCounts_Prep.run_parameters =  ["-g gene_id -s 0 -Q 20 -T 2 -B -d 50 -D 1000 -C --fracOverlap 0 --minOverlap 1","-g transcript_id -s 0 -Q 20 -T 2 -B -d 50 -D 1000 -C --fracOverlap 0 --minOverlap 1"]  //* @input  @description:"-s Indicate strand-specific read counting: 0 (unstranded, default), 1 (stranded) and 2 (reversely stranded) -Q The minimum mapping quality score -T Number of threads -B requireBothEndsMapped -C countChimericFragments −−fracOverlap Minimum fraction of overlapping bases −−minOverlap Minimum number of overlapping bases" 

// Process Parameters for BAM_Analysis_Module_IGV_BAM2TDF_converter:
params.BAM_Analysis_Module_IGV_BAM2TDF_converter.igv_extention_factor =  "0"  //* @input @description:"The read or feature is extended by the specified distance in bp prior to counting. This option is useful for chip-seq and rna-seq applications. The value is generally set to the average fragment length of the library minus the average read length." @tooltip:"igvtools is used"
params.BAM_Analysis_Module_IGV_BAM2TDF_converter.igv_window_size =  "5"  //* @input  @description:"The window size over which coverage is averaged." @tooltip:"igvtools is used"

// Process Parameters for ChIP_Module_ChIP_Prep:
params.ChIP_Module_ChIP_Prep.macs2_callpeak_parameters =  ""  //* @input @description:"macs2 callpeak parameters"
params.ChIP_Module_ChIP_Prep.peak_calling_type =  "narrow"  //* @dropdown @options:"narrow","broad"
params.ChIP_Module_ChIP_Prep.band_width =  "300"  //* @input @description:"Band width for picking regions to compute fragment size."
params.ChIP_Module_ChIP_Prep.bedtoolsCoverage_Parameters =  "-sorted -nobuf -hist "  //* @input @description:"bedtools Coverage parameters"
params.ChIP_Module_ChIP_Prep.compare_Custom_Bed =  ""   //* @input @description:"Enter custom bed file <full path> for comparison"
params.ChIP_Module_ChIP_Prep.output_prefix =  ""  //* @input @title:"Sample Definitions" @description:"Output files will be created by using output_prefix"
params.ChIP_Module_ChIP_Prep.sample_prefix =  ""  //* @description:"Use prefix of the sample to match files. You can use comma separated format to enter multiples files. Eg.Sample1_L001,Sample2_L001" @input 
params.ChIP_Module_ChIP_Prep.input_prefix =  ""  //* @description:"Use prefix of the input to match files. You can use comma separated format to enter multiples files. Eg.Sample1_L001,Sample2_L001" @input

// Process Parameters for ChIP_Module_Scripture_peakrescore:
params.ChIP_Module_Scripture_peakrescore.window =  "200"  //* @input
params.ChIP_Module_Scripture_peakrescore.trimFraction =  "0.15"  //* @input

// Process Parameters for Homer_Find_Motif_Module_homer_find_Motifs_Genome:
params.Homer_Find_Motif_Module_homer_find_Motifs_Genome.size =  "200"  //* @input @description:"Supported Organisms for Homer: Human (hg19), Mouse (mm10). Homer findMotifsGenome.pl parameter. Size of the region for motif finding (default: 200)  If you wish to find motifs using your peaks using their exact sizes, use the option "given").  However, for Transcription Factor peaks, most of the motifs are found +/- 50-75 bp from the peak center, making it better to use a fixed size rather than depend on your peak size."

// Process Parameters for ChIP_Module_bedtools_coverage:
params.ChIP_Module_bedtools_coverage.bedtoolsCoverage_Parameters =  "-sorted -hist "  //* @input @description:"bedtools Coverage parameters"
params.ChIP_Module_bedtools_coverage.bedtoolsIntersect_Parameters =  ""  //* @input @description:"bedtools Intersect optional parameters"

// Pipeline Config:
$HOSTNAME='default'
params.genome_build = "" //* @dropdown @options:"human_hg19_refseq, human_hg38_genecode_v28, mouse_mm10_refseq, rat_rn6_refseq, rat_rn6_ensembl_v86, zebrafish_GRCz11_ensembl_v95, zebrafish_GRCz11_refseq, zebrafish_GRCz11_v4.1.2, c_elegans_ce11_ws245, mousetest_mm10, custom"
params.run_Bowtie2 = "yes" //* @dropdown @options:"yes","no" @show_settings:"Map_Bowtie2"
params.run_ChIP_MACS2 = "yes" //* @dropdown @options:"yes","no" @show_settings:"ChIP_Prep","bedtools_coverage"
params.run_checkAndBuild = "no" //* @dropdown @options:"yes","no"  @show_settings:"Check_Build_STAR_Index, Check_Build_Bowtie2_Index, Check_Build_Hisat2_Index, Check_Build_Rsem_Index, Check_Build_Bowtie_Index"
params.run_Split_Fastq =  "no"  //* @dropdown @options:"yes","no" @show_settings:"SplitFastq"
params.run_FastQC =  "yes"  //* @dropdown @options:"yes","no"
params.run_Adapter_Removal =  "no"  //* @dropdown @options:"yes","no" @show_settings:"Adapter_Removal"
params.run_Trimmer =  "no"  //* @dropdown @options:"yes","no" @show_settings:"Trimmer"
params.run_Quality_Filtering =  "no"  //* @dropdown @options:"yes","no" @show_settings:"Quality_Filtering"
params.run_Sequential_Mapping =  "no"  //* @dropdown @options:"yes","no" @show_settings:"Sequential_Mapping"

params.run_IGV_TDF_Conversion = "no" //* @dropdown @options:"yes","no" @show_settings:"IGV_BAM2TDF_converter"
params.run_RSeQC = "no" //* @dropdown @options:"yes","no"
params.run_Picard_CollectMultipleMetrics = "no" //* @dropdown @options:"yes","no"
params.run_BigWig_Conversion = "no" //* @dropdown @options:"yes","no"
params.run_Remove_Multimappers_with_Samtools = "no"  //* @dropdown @options:"yes","no"
params.run_Remove_Multimappers_with_Picard = "yes" //* @dropdown @options:"yes","no"
params.run_Scripture = "no"
params.run_Motif_Finder_on_ChIP_Peaks = "no"


profiles {
  test { includeConfig 'conf/test.config' }
  docker { 
        process.container = "dolphinnext/chipatacseq:1.0"
        params.DOWNDIR="$HOME" // path where genome data will be saved and it should be different than run directory
        docker.enabled = true 
        docker.runOptions = "-v ${params.DOWNDIR}:${params.DOWNDIR}" 
            
  }
  singularity { 
        process.container = "dolphinnext/chipatacseq:1.0"
        params.DOWNDIR="$HOME" // path where genome data will be saved and it should be different than run directory
        singularity.enabled = true 
        singularity.runOptions = "--bind ${params.DOWNDIR}" 
  }
}


_species    = ""
_build      = ""
_share      = ""
_annotation = "" 
//* autofill
_nucleicAcidType = "dna"
params.nucleicAcidType = "dna"
if (params.genome_build == "mousetest_mm10"){
    _species = "mousetest"
    _build = "mm10"
    _annotation = "refseq_170804"
} else if (params.genome_build == "human_hg19_refseq"){
    _species = "human"
    _build = "hg19"
    _annotation = "refseq_020216"
} else if (params.genome_build == "human_hg38_genecode_v28"){
    _species = "human"
    _build = "hg38"
    _annotation = "genecode_v28"
} else if (params.genome_build == "mouse_mm10_refseq"){
    _species = "mouse"
    _build = "mm10"
    _annotation = "refseq_011015"
} else if (params.genome_build == "rat_rn6_refseq"){
    _species = "rat"
    _build = "rn6"
    _annotation = "refseq_070716"
} else if (params.genome_build == "rat_rn6_ensembl_v86"){
    _species = "rat"
    _build = "rn6"
    _annotation = "ensembl_v86"
} else if (params.genome_build == "zebrafish_GRCz11_ensembl_v95"){
    _species = "zebrafish"
    _build = "GRCz11"
    _annotation = "ensembl_v95"
} else if (params.genome_build == "zebrafish_GRCz11_refseq"){
    _species = "zebrafish"
    _build = "GRCz11"
    _annotation = "refseq_240519"
} else if (params.genome_build == "zebrafish_GRCz11_v4.1.2"){
    _species = "zebrafish"
    _build = "GRCz11"
    _annotation = "refseq_v4.1.2"
} else if (params.genome_build == "c_elegans_ce11_ensembl_ws245"){
    _species = "c_elegans"
    _build = "ce11"
    _annotation = "ensembl_ws245"
} 

if ($HOSTNAME == "default"){
    _share = "${params.DOWNDIR}/genome_data"
    _bin = "${params.DOWNDIR}/bin"
    $DOCKER_IMAGE = "dolphinnext/chipatacseq:1.0"
    $DOCKER_OPTIONS = "-v ${params.DOWNDIR}:${params.DOWNDIR}"
}
//* platform
if ($HOSTNAME == "ghpcc06.umassrc.org"){
    _share = "/share/data/umw_biocore/dnext_data/genome_data"
    _bin   = "/share/data/umw_biocore/dnext_data/bin"
    $SINGULARITY_IMAGE = "/project/umw_biocore/singularity/UMMS-Biocore-chipatacseq-1.0.img"
    $SINGULARITY_OPTIONS = "--bind /share --bind /nl --bind /project"
    $TIME = 240
    $CPU  = 1
    $MEMORY = 32 
    $QUEUE = "short"
} 
//* platform

if (params.genome_build && $HOSTNAME){
    params.genome_url   = "https://galaxyweb.umassmed.edu/pub/dnext_data/genome_data/${_species}/${_build}/main/genome.fa"
    params.gtf_url      = "https://galaxyweb.umassmed.edu/pub/dnext_data/genome_data/${_species}/${_build}/${_annotation}/genes/genes.gtf"
    params.commondb_url = "https://galaxyweb.umassmed.edu/pub/dnext_data/genome_data/${_species}/${_build}/commondb/"
    
    params.genome       = "${_share}/${_species}/${_build}/main/genome.fa"
    params.genome_sizes = "${_share}/${_species}/${_build}/main/genome.chrom.sizes"
    params.bed          = "${_share}/${_species}/${_build}/${_annotation}/genes/genes.bed"
    params.gtf          = "${_share}/${_species}/${_build}/${_annotation}/genes/genes.gtf"
    params.commondb     = "${_share}/${_species}/${_build}/commondb/"
    
    params.bowtie_index  = "${_share}/${_species}/${_build}/BowtieIndex/genome"
    params.bowtie2_index = "${_share}/${_species}/${_build}/Bowtie2Index/genome"
    params.star_index    = "${_share}/${_species}/${_build}/${_annotation}/STARIndex/"
    params.hisat2_index  = "${_share}/${_species}/${_build}/${_annotation}/Hisat2Index/genome"
    params.rsem_ref_using_bowtie_index  = "${_share}/${_species}/${_build}/${_annotation}/RSEM_ref_Bowtie/genome"
    params.rsem_ref_using_bowtie2_index = "${_share}/${_species}/${_build}/${_annotation}/RSEM_ref_Bowtie2/genome"
    params.rsem_ref_using_star_index    = "${_share}/${_species}/${_build}/${_annotation}/RSEM_ref_STAR/genome"
    
    params.bowtieInd_rRNA  = "${_share}/${_species}/${_build}/commondb/rRNA/rRNA"
    params.bowtieInd_ercc  = "${_share}/${_species}/${_build}/commondb/ercc/ercc"
    params.bowtieInd_miRNA = "${_share}/${_species}/${_build}/commondb/miRNA/miRNA"
    params.bowtieInd_tRNA  = "${_share}/${_species}/${_build}/commondb/tRNA/tRNA"
    params.bowtieInd_piRNA = "${_share}/${_species}/${_build}/commondb/piRNA/piRNA"
    params.bowtieInd_snRNA = "${_share}/${_species}/${_build}/commondb/snRNA/snRNA"
    params.bowtieInd_rmsk  = "${_share}/${_species}/${_build}/commondb/rmsk/rmsk"
    
}
if ($HOSTNAME){
    params.pdfbox_path = "/usr/local/bin/dolphin-tools/pdfbox-app-2.0.0-RC2.jar"
    params.gtf2bed_path = "/usr/local/bin/dolphin-tools/gtf2bed"
    params.peakrescore_path = "/usr/local/bin/dolphin-tools/scripture_v0.1/peakrescore.jar"
    params.peakrescore_class_path = "/usr/local/bin/dolphin-tools/scripture_v0.1"
    params.homer_dir = "${_bin}/homer"
}
//* autofill






